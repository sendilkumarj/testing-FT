<apex:page sidebar="false" id="mainPage" controller="AddEditPeople" tabStyle="Plan__c"> 
<html>
    <head>
       <!--------- FT Stylesheets -----------> 
     
       <apex:stylesheet value="{!$Page.CommonStyles}" />
       <apex:stylesheet value="{!$Page.SocialInputStyles}" />   
       <apex:stylesheet value="{!$Page.OverrideStyles}" />
       
       <!--------- FT Scripts ----------->
       <!--<apex:includeScript value="{!URLFOR($Resource.JqueryUITabs, '/tabs/jquery-1.8.3.js')}"/>-->
       <apex:includeScript value="{!$Page.CommonScripts}" />
       <apex:includeScript value="{!$Page.SocialInputScripts}" />

       
       <!-- Kendo Library -->
      <c:WalkMeAndSupportButton />
      <c:CommonLibraries />
       <!--<script type="text/javascript">(function() {var walkme = document.createElement('script'); walkme.type = 'text/javascript'; walkme.async = true; walkme.src = 'https://d3b3ehuo35wzeh.cloudfront.net/users/3d4e7e29fbce4945a03495f309d755c1/test/walkme_3d4e7e29fbce4945a03495f309d755c1_https.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(walkme, s);})();</script>-->
       <script>
       
       //FT Favicon
       (function() {
        var link = document.createElement('link');
        link.type = 'image/x-icon';
        link.rel = 'shortcut icon';
        link.href = '{!$Resource.Favicon}';
        document.getElementsByTagName('head')[0].appendChild(link);
         $(document).prop('title', 'Add / Edit People');
    }());
           var existingFormSize = 0;
           var searchClick  = false;
           $(document).ready(function(){
              changeFooterText(); 
              dragModal();
              //setDimension();
           });
           
           // script for google analytics
             var _gaq = _gaq || [];
              _gaq.push(['_setAccount', 'UA-34907619-2']);
              _gaq.push(['_trackPageview']);
            
              (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
              })();
       </script>
       <style>
             .k-window-titlebar .k-header{
                min-height: 26px !important;
                margin-top: -45px !important;
                border-bottom-width: 2px !important;
                border-bottom-color: #d8d5d1 !important;
                background: url("{!URLFOR($Resource.Images, 'common/image-modalHead-1x38.jpg')}") repeat-x !important;
                
            }
            .k-window-titlebar {
				 min-height: 24px;    
				 line-height: 1.6em;
				 font-size: 1.1em;
			     border: 0px !important;
				 background: url("{!URLFOR($Resource.Images, 'common/image-modalHead-1x38.jpg')}") repeat-x !important;
			 }
             .k-window-title{
                font-size: 1.3em;
                top: 7px;
                font-weight:bold;
                cursor:move;
                margin-left: 0.5em;
            }
            .k-window-titlebar .k-window-actions{
                top: 3px;
            }
            div.k-window-content{
                padding: 0px;
            }
       </style>
    </head>
    <body>
       
            <!------------ Content -------------->
       <div class = "wrapper">
                <!------------ Page Header -------------->
            <div class = "page-head header-border">
                <div class = "object-icon ft-left">
                    <img src = "{!URLFOR($Resource.Images, 'common/icon-addEditPeople-32x32.png')}" />
                </div>
                <div class = "headers ft-left">
                    <span class = "page-subhead ft-left">Add / Edit People</span><br />
                    <h2> <apex:outputText value="{!headerName}"/> </h2>
                </div>
            </div>
            <div id="chkStatus" style="font-size:4px;color:white">{!HTMLENCODE(decisionPhase)}</div><div id="chkUserName" style="font-size:4px;color:white"><apex:outputText value="{!$User.FirstName} {!$User.LastName}" /></div>
            <apex:pageMessages />
                <!------------ End Page Header -------------->
                <!------------ Add Collaborators Section --------------> 
            <div class = "social-section-head">
                <img class = "ft-left" src = "{!URLFOR($Resource.Images, 'common/icon-addPeople-24x24.png')}" />
                <h3 class = "ft-left">Add People&nbsp;<img title="Click Search to get a complete list of users who are not yet collaborators of this decision or type the name you are looking for. You can use * as a wildcard at the end of your search criteria." src = "{!URLFOR($Resource.Images, 'common/icon-help-16x16.png')}" /></h3>                
            </div> 
            
            <div class = "social-search-container">
                <div class="ft-left">Search &nbsp;
                <select id="selectList">
                  <option value="User">Users</option>
                  <option value="Group">Public Groups</option>
                </select>
                &nbsp;&nbsp;for &nbsp;
                </div>
                <!--<input type = "text" id="searchText"/>&nbsp;&nbsp;
                <button type = "button" onclick="searchUsers()">Search</button>-->
                <div class = "ft-left decisionSearch">
                     <span class = " k-textbox k-space-right"> 
                        <input type="text" placeholder="Search..." id="searchText"/>
                        <a href="#"  class="k-icon k-i-search" onclick="searchUsers()">&nbsp;</a>
                     </span>
                </div>
                
            </div>
            <div id = "searchWrap">
            <apex:form id="searchTable">
            
                <div class = "warn-msg">{!HTMLENCODE(message)}</div>
                <div class = "social-table-container">    
                    
                     <div class = "tbl-container-search">
                     <div id="gridSearchUsers"></div>
                        <script>
                            $(document).ready(function () {
                                 
                                   kendoSearchTable($.parseJSON('{!JSENCODE(searchedUserJSON)}'));
                                   $('#groupBtn').css('display','block')
                                  
                            });
                        </script>   
                        <style>
                            .k-state-selected, .k-list>.k-state-selected, .k-list>.k-state-focused, .k-panelbar .k-state-selected, .k-button:active, .k-ghost-splitbar-vertical, .k-ghost-splitbar-horizontal, .k-draghandle.k-state-selected:hover{
                                background-color: #999;
                                border-color: #999;
                              }
                        </style> 
                     </div>   
                </div>
                <apex:outputPanel rendered="{!IF(OR(searchType == null,searchType == 'User'),true,false)}" >
                        <!------------- User Button -------------->
                    <!---<div class = "tbl-buttons-add btn-hold-width1" id = "userBtn">
                       
                        <button type="button" onclick="addAsUsers()">Add</button>
                        
                    </div> --->
                    
                    <div class = "tbl-buttons-add btn-hold-width2" id = "groupBtn">
                        <div class = "group-as">
                                               
                            
                            <div class = "add-as-option ft-left">
                                <div class="fontBold ft-left" style="margin-top: 2px;">Role:</div>
                                    <div class = " option-user ft-left"> 
                                <apex:outputPanel rendered="{!IF(OR(chkRecPermission==true,myRole.Accountable__c==true,myRole.Responsible__c==true,myRole.Backup_for_Accountable__c==true),True,False)}" >                                  
                                    <input type="radio" name="fortruefalse" checked="true" id="responsibleUser" />Responsible
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!IF(AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false,myRole.Backup_for_Accountable__c==false),True,False)}" >                                  
                                    <input type="radio"  name="fortruefalse" checked="true" disabled="disabled" id="responsibleUser" />Responsible
                                </apex:outputPanel>
                                </div>
                                  <div class = " option-user ft-left"> 
                                    <apex:outputPanel rendered="{!IF(AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false,myRole.Backup_for_Accountable__c==false),True,False)}" >  
                                        <input type="radio" checked="true" name="fortruefalse"  id="consultedUser" />Consulted
                                    </apex:outputPanel>    
                                    <apex:outputPanel rendered="{!IF(OR(chkRecPermission==true,myRole.Accountable__c==true,myRole.Responsible__c==true,myRole.Backup_for_Accountable__c==true),True,False)}" >                               
                                        <input type="radio" name="fortruefalse"  id="consultedUser" />Consulted
                                     </apex:outputPanel> 
                                </div>
                                <div class = " option-user ft-left">                                  
                                    <input type="radio" name="fortruefalse" id="informedUser" />Informed
                                </div>
                            </div>
                            <div class = "add-as-btn ft-left toClear">
                                <button id="onluaddUserButtoninwrrap" type="button" class="k-button" onclick="addAsUsersFromDecisionWrapper()">Add</button>
                                <!--<button id="onluaddUserButtoninwrrapforGroup" style="display:none" type="button" disabled="disabled">Add</button>-->
                                <button id="addUserButton" type="button" class="k-button" onclick="addAsUsersFromDecision()">Add &amp; Close</button>
                                <!--<button id="addUserButton1" style="display:none" type="button" disabled="disabled">Add &amp; Close</button>-->
                            </div>                     
                        </div>
                    </div> 
                        <!------------- End User Button -------------->
                </apex:outputPanel>
                <apex:actionFunction name="AddUsers" action="{!addingUserBasedOnType}" oncomplete="showAddButton();simplyRenderTheTable(); $(window).scrollTop( $('#editTable').height() )" reRender="existingUserForm,searchTable" >
                    <apex:param name="selectedUsers" id="selectedUsers" value="" />
                    <apex:param name="userType" id="userType" value="" />
                    <apex:param name="addingAsInformed" id="addingAsInformed" value="" />
                    <apex:param name="addingAsResponsible" id="addingAsResponsible" value="" />
                    <apex:param name="addingAsConsulted" id="addingAsConsulted" value="" />
                </apex:actionFunction>
                 <apex:actionFunction name="AddUserinwrapp" action="{!addinWrapeerUserBasedOnType}" oncomplete="showAddButton();simplyRenderTheTable(); $(window).scrollTop( $('#editTable').height() )" reRender="existingUserForm,searchTable" >
                    <apex:param name="selectedUserswrap" id="selectedUserswrap" value="" />
                    <apex:param name="userTypewrap" id="userTypewrap" value="" />
                    <apex:param name="addingAsInformedwrap" id="addingAsInformedwrap" value="" />
                    <apex:param name="addingAsResponsiblewrap" id="addingAsResponsiblewrap" value="" />
                    <apex:param name="addingAsConsultedwrap" id="addingAsConsultedwrap" value="" />
                </apex:actionFunction>  
                <apex:outputPanel rendered="{!IF(searchType == 'Group',true,false)}" >    
                    <!------------- Group Button -------------->
              <!--
                    Enable Add button and the check boxes for Adding Users. This section will be displayed when type of search is "Groups"
                -->
                <div class = "tbl-buttons-add btn-hold-width2" id = "groupBtn">
                    <div class = "group-as">
                    <!--
                        Add extra divs to align --- sendil --- 11-07-2014
                        -->
                        <div class = "add-as-option ft-left">
                           <div class="fontBold ft-left" style="margin-top: 2px;">Role:</div>
                           <div class="toClear" style="margin-top: 25px;">
                         <div class="fontBold ft-left" style="margin-top: 2px;">  As Individuals :</div>
                        <div class = "option-user ft-left">
                            <apex:outputPanel rendered="{!IF(OR(chkRecPermission==true,myRole.Accountable__c==true,myRole.Responsible__c==true,myRole.Backup_for_Accountable__c==true),True,False)}" >                                  
                                <input type="radio" name= "truefalsegrp"   id="responsibleGroup" />Responsible
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!IF(AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false,myRole.Backup_for_Accountable__c==false),True,False)}" >                                  
                                <input type="radio" name= "truefalsegrp" disabled="disabled" id="responsibleGroup" />Responsible
                            </apex:outputPanel>
                            
                        </div>
                        <div class = "option-user ft-left">
                            <input type="radio" name= "truefalsegrp" id="consultedGroup" />Consulted
                        </div>
                        <div class = "option-user ft-left ">
                            <input type="radio" name= "truefalsegrp" id="informedGroup"   />Informed
                        </div> 
                         <div class = "option-user ft-left "><input type="radio" name= "truefalsegrp" checked="checked" id = "noneId"  />None
                        </div> 
                        </div>
                        <div class="toClear " style="margin-top: 75px;">
                         <div class="fontBold ft-left" style="margin-top: 2px;">As Group:</div> <div class="option-user ft-left" style="margin-top: 2px;"><input type="checkbox"  checked="checked"   disabled = "disabled"/></div><div class="ft-left" style="margin-top: 4px;">Informed
                            </div> 
                        </div>
                        <div class = "add-as-btn toClear" style="margin-top: 25px;">
                        <div class="ft-left">
                            <button id="onluaddUserButtoninwrrapforGroup" class="k-button" type="button" onclick="addAsGroupinWrapp()">Add</button>
                            <button id="addGrpButton" type = "button" class="k-button" onclick="addAsGroup();">Add &amp; Close</button>
                        </div>
                           <div class="ft-left" style="margin:5px 5px;">Members of selected groups will be expanded and added as individual contributors</div>
                           </div>
                        </div>
                    </div>
                </div>  
                    <!------------- End Group Button -------------->
                </apex:outputPanel>              
            </apex:form>
            </div>       
       </div>
           <!------------ End Add Collaborators Section -------------->   
                
                <!------------ Edit Collaborators Section -------------->
            <div class = "social-section-head">
                <img class = "ft-left" src = "{!URLFOR($Resource.Images, 'common/icon-editPeople-24x24.png')}" />
                <h3 class = "ft-left">Edit People <img title="Use the checkboxes to edit the roles of the added people. If approval is required for role acceptance, please select the approval required checkbox." src = "{!URLFOR($Resource.Images, 'common/icon-help-16x16.png')}" /></h3>
            </div> 
            <div id="currentUserId" class="user-accountablity" ><apex:outputText value="{!$User.Id}" /></div>
            <apex:form id="existingUserForm">
                <div class = "content-text">
                
                 <div class = "tbl-buttons-add textLeft ft-left" style="margin-left: 22px;">
                    <button type = "button" class="k-button" onclick="saveClose()">Save and Close</button>
                    <button type = "button" class="k-button" onclick="cancel()">Cancel</button>
                    
                    </div>
                   <div class = "ft-right" style="margin-right: 25px;">
                     <label>
                     <apex:inputCheckbox disabled="{!IF(OR(myRole.Accountable__c,myRole.Responsible__c,myRole.Backup_for_Accountable__c),false,true)}"  id="permissionToCIOnPlan" value="{!planData.Add_C_I_Members__c}" rendered="{!If(objType == 'Plan',true,false)}"/>&nbsp;Consulted or Informed collaborators can add/edit others to be Consulted or Informed</label>&nbsp;
                     <img src = "{!URLFOR($Resource.Images, 'common/icon-help-16x16.png')}" title="Normally, only the Accountable and Responsibles can edit a decision and invite people. Checking this checkbox allows Consulted or Informed collaborators to invite other users to be Consulted or Informed." /> 
                </div> 
                <!------------ Edit Collaborators Table -------------->
            
                <script>
                    existingFormSize = {!existingPeopleWrapperList.size};
                    //existingFormSize = existingFormSize - 1;
                </script>
                <div class = "social-table-container toClear" id = "editTable">
                    <div class = "tbl-disable"></div>
                   <!-- <div class = "ci-help ft-right">
                        
                    </div> -->
                    <table cellspacing = "0" cellpadding = "0" class = "tbl-people">
                        <tr>
                            <td class = "social-thead cell-width7">
                                Action
                            </td>
                            <td class = "social-thead" colspan = "2">
                                Name
                            </td>
                            <td class = "social-thead cell-width2">
                                Department
                            </td>
                            <td class = "social-thead cell-width3">
                                Responsible
                            </td>
                            <td class = "social-thead cell-width3">
                                Accountable
                            </td>
                            <td class = "social-thead cell-width4">
                                Consulted
                            </td>
                            <td class = "social-thead cell-width4">
                                Informed
                            </td>
                            <td class = "social-thead cell-width3">
                                Role<br />Acceptance<br />Required
                            </td>
                            <td class = "thead-seperator" >
                               &nbsp; 
                            </td>
                            <td class = "social-thead cell-width5">
                                Backup<br />For<br />Accountable
                                <img title="A collaborator with the Backup option ticked gets the same privileges as the Accountable. There can only be one Backup at the time. Only the Accountable or the Backup can edit this column." src = "{!URLFOR($Resource.Images, 'common/icon-help-16x16.png')}" /> 
                            </td>
                            <td class = "social-thead cell-width6">
                                Veto<br />Rights
                                <img title="A collaborator with the Veto option can reject a decision. I.e. by giving his own rejection, the decision status will also become Rejected regardless of the opinion of the other collaborators." src = "{!URLFOR($Resource.Images, 'common/icon-help-16x16.png')}" />
                            </td>
                            <td class = "social-thead cell-width2 thead-rborder">
                                Description
                                <img title="Include further information on the role. You might indicate 'Legal' or 'Marketing' to indicate what stakeholder a collaborator represents" src = "{!URLFOR($Resource.Images, 'common/icon-help-16x16.png')}" />
                            </td>
                        </tr>
                        <apex:variable value="{!0}" var="count"/> 
                        <apex:repeat id="peopleRepeat" value="{!existingPeopleWrapperList}" var="exist" >
                        <script>
                        $('.group-link').hover(function(e) {                                   
                            var content = $(this).next().html();
                            if(content != ''&& content != undefined ){
                                content = content.replace(/,/g, '<br>');
                                $('.popover-social-content').html(content);                   
                                $('.popover-social').show()
                                .css('top', e.pageY - 25)
                                .css('left', e.pageX + 50)
                                .appendTo('body');
                            }
                         },function() {
                            $('.popover-social').hide();
                         });
                    </script>
                        <tr>
                            <td class = "social-tcell tcell-left cell-center">
                                <span id="userAccountablity{!FLOOR(count)}" class="user-accountablity" >{!if(exist.socialRec.Accountable__c,'ACCOUNTABLE','NOTACCOUNTABLE')}</span><img id="deletingIcon{!FLOOR(count)}" onclick="deleteUserFromEditTable(this.title,'{!IF(exist.SocialRec.User__c != null,exist.SocialRec.User__c,exist.SocialRec.GroupId__c)}')" src="{!IF(OR(exist.socialRec.Accountable__c,($User.Id == exist.socialRec.User__c),(AND(OR(myRole.Consulted__c==TRUE,myRole.Informed__c==TRUE),myRole.Accountable__c==False,myRole.Responsible__c==False,myRole.Backup_for_Accountable__c==false,planData.Add_C_I_Members__c,exist.isNewUserAdded == 'ExistingUser'))),URLFOR($Resource.Images,'common/icon-deleteDisabled-16x16.png'),URLFOR($Resource.Images,'common/icon-delete-16x16.png'))}" style="{!IF(OR(exist.socialRec.Accountable__c,($User.Id == exist.socialRec.User__c),(AND(OR(myRole.Consulted__c==TRUE,myRole.Informed__c==TRUE),myRole.Accountable__c==False,myRole.Responsible__c==False,myRole.Backup_for_Accountable__c==false,planData.Add_C_I_Members__c,exist.isNewUserAdded == 'ExistingUser'))),'cursor:default','cursor:pointer')}" title="{!IF(OR(exist.socialRec.Accountable__c,($User.Id == exist.socialRec.User__c),(AND(OR(myRole.Consulted__c==TRUE,myRole.Informed__c==TRUE),myRole.Accountable__c==False,myRole.Responsible__c==False,myRole.Backup_for_Accountable__c==false,planData.Add_C_I_Members__c,exist.isNewUserAdded == 'ExistingUser'))),'','Delete')}" /> 
                            </td>
                            <td class = "social-tcell">
                            
                            <apex:outputPanel rendered="{!if(exist.socialRec.User__r.name == '',true,false)}">
                                        <apex:outputPanel rendered="{!If(exist.socialRec.User__c != null,true,false)}" >
                                            <a href="/{!exist.socialRec.User__c}" target="_blank"><apex:outputText value="{!exist.socialRec.Name_of_the_User__c}" /></a>
                                        </apex:outputPanel>
                                </apex:outputPanel>
                            
                            
                                <a href="{!if(exist.socialRec.User__c != null,'/'+exist.socialRec.User__c,'javascript:void(0)')}" onclick="groupMemberPopup('{!JSENCODE(exist.socialRec.GroupId__c)}','{!JSENCODE(exist.groupName)}');" target="{!if(exist.socialRec.User__c != null,'_blank','')}"><span id="userID{!FLOOR(count)}" class="user-accountablity" >{!IF(exist.socialRec.User__c != null,exist.socialRec.User__c,exist.socialRec.GroupId__c)}</span><apex:outputText value="{!IF(exist.socialRec.User__c != null,exist.socialRec.User__r.Name,exist.groupName)}" /></a>    
                            </td>
                            <td class = "social-tcell info-cell cell-width8">
                                <apex:image styleClass="group-img" url="{!URLFOR($Resource.Images,'common/icon-info-16x16.png')}" rendered="{!if(exist.socialRec.Group_Name__c != '',true,false)}" title="{!exist.socialRec.Group_Name__c}"/>
                            </td> 
                            <td class = "social-tcell">
                                <span id="userNature{!FLOOR(count)}" class="user-accountablity" >{!exist.isNewUserAdded}</span>
                                <apex:outputText value="{!exist.socialRec.User__r.Department}" rendered="{!IF(exist.SocialRec.User__c != null,true,false)}" />
                            </td>
                            <td class = "social-tcell cell-center">
                                <apex:inputCheckbox id="responsibleRole"  disabled="{!IF(OR(exist.socialRec.User__c == null,AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false)) ,true,false)}" value="{!exist.socialRec.Responsible__c}"   />
                            </td>
                            <td class = "social-tcell cell-center">
                                <apex:inputCheckbox id="accountableRole"  disabled="{!IF(OR(exist.socialRec.User__c == null,AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false)) ,true,false)}" onclick="singleAccounatble({!FLOOR(count)}, '{!URLFOR($Resource.Images,'common/icon-deleteDisabled-16x16.png')}' , '{!URLFOR($Resource.Images,'common/icon-delete-16x16.png')}')"  value="{!exist.socialRec.Accountable__c}"   />
                            </td>
                            <td class = "social-tcell cell-center">
                                <apex:inputCheckbox id="consultedRole" disabled="{!IF( (exist.socialRec.User__c == null ) || ( exist.isNewUserAdded != 'NewUser'  && AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false) ),true,false)}"  value="{!exist.socialRec.Consulted__c}"   />
                            </td>
                            <td class = "social-tcell cell-center">
                                <apex:inputCheckbox id="informedRole"  disabled="{!IF( (exist.socialRec.User__c == null )|| ( exist.isNewUserAdded != 'NewUser' && AND(chkRecPermission!=true,myRole.Accountable__c==false,myRole.Responsible__c==false) ),true,false)}"  value="{!exist.socialRec.Informed__c}"   />
                            </td>
                            <td class = "social-tcell cell-center">
                                <input type="checkbox" disabled="disabled" />
                            </td>
                            <td class = "tcell-seperator" >
                               &nbsp; 
                            </td>
                            <td class = "social-tcell cell-center">
                                <input type="checkbox" disabled="disabled" />
                            </td>
                            <td class = "social-tcell cell-center">
                                <input type="checkbox" disabled="disabled" />
                            </td>
                            <td class = "social-tcell tcell-right">
                                   <apex:outputPanel rendered="{!if(AND(exist.isNewUserAdded == 'ExistingUser',OR(myRole.Informed__c==true,myRole.Consulted__c== true)),true,false)}" >
                                    <apex:outputField styleClass="social-textarea" value="{!exist.socialRec.Description__c}" />
                                 </apex:outputPanel>
                                  <apex:outputPanel rendered="{!if(OR(AND(exist.isNewUserAdded == 'NewUser',exist.isNewUserAdded != 'ExistingUser'),myRole.Accountable__c,myRole.Responsible__c),true,false)}" >
                                     <apex:inputField styleClass="social-textarea" value="{!exist.socialRec.Description__c}" />
                                 </apex:outputPanel>
                            </td>
                        </tr>
                        <apex:variable var="count" value="{!count+ 1}"/>
                        </apex:repeat>
                        
                        
                    </table>
                </div> 
                    <!------------ End Edit Collaborators Table -------------->
                <div class = "tbl-buttons-add  textLeft" style="margin-left: 22px;">
<!--                     <button type = "button"  onclick="saveNow()">Save</button>  -->
                   <button type = "button" class="k-button" onclick="saveClose()">Save and Close</button>
                    <button type = "button" class="k-button" onclick="cancel()">Cancel</button>
                    <apex:actionFunction name="saveNow" action="{!saveCurrentPeople}" /> 
                    <apex:actionFunction name="saveClose" action="{!savePeople}" />
                    <apex:actionFunction name="cancel" action="{!cancel}" /> 
                    
                    
                    <apex:actionFunction name="DelPeople" action="{!deletePeople}" reRender="existingUserForm" oncomplete="disableChkOnLoadVeto();removePreloader();" >
                        <apex:param name="socialInputId" id="socialInputId" value="" />
                        <apex:param name="existType" id="existType" value="" />
                        <apex:param name="userType" id="userType" value="" />
                        <apex:param name="recordsId" id="recordsId" value="" />
                    </apex:actionFunction>   
                    <apex:actionFunction name="deleteThisUser" action="{!deleteThisSocialInput}" reRender="existingUserForm" oncomplete="removePreloader();" >
                        <apex:param name="socialInputIdToBeDeleted" id="socialInputIdToBeDeleted" value="" /> 
                    </apex:actionFunction>
                </div>
                </div>
            </apex:form>
                <!------------ End Edit Collaborators Section --------------> 
                  
                <!------------ End Content -------------->
           <apex:form >
               <apex:actionFunction name="searchSelectedUsers"   action="{!searchUsers}" oncomplete="$('#searchWrap').css('display','block');hideLoaderOnSearch();"  reRender="searchTable" >
                  <apex:param name="searchText" id="searchText" value="" />
                   <apex:param name="searchType" id="searchType" value="" />
               </apex:actionFunction>
               <apex:actionFunction name="simplyRenderTheTable" action="{!dummyRender}" reRender="existingUserForm" /> 
           </apex:form>
           
           <!--------- Popup ----------->
    <div class = "bg-fade"></div>
    <div class = "preloader"></div>
    <div class = "modal-window">
        <div class = "modal-head">
             <!--------- Popup Group Member Header -----------> 
            <div class = "modal-group-header ft-left" id = "groupMember-header"  style="display:none">
                 Members of Group - <span class = "group-name"></span> 
            </div>
            <!--------- End Group Member Header ----------->
            <a class = "modal-close" href = "javascript: void(0);" onclick = "hideModal()"></a>
        </div>    
        <!--------- Popup Group Member Content ----------->
        <div class = "modal-content" id = "groupMember-body">
            <div id="gridGroupMember"></div>
        </div>
        <!--------- End Popup Group Member Content ----------->
        <div class = "modal-btm">
            <!--------- Popup Popup Group Member Footer ----------->  
           <div class = "modal-footer" id = "groupMember-footer">                   
                <button type = "button" class="k-button" onclick = "hideModal()">Close</button>
           </div>
           <!--------- End Popup Popup Group Member Footer ----------->  
        </div>        
     </div> 
         <!--------- End Popup ----------->
         <!----------- Popover Group -------------->
     <div class = "popover-social">
         <div class = "popover-arrow-hold"><div class = "popover-social-arrow"></div></div>
         <div class = "popover-social-top">Group Members</div>
         <div class = "popover-social-content"></div>
         <div class = "popover-social-btm">Click on the link to see more</div>
     </div>
         <!----------- End Popover Group -------------->   
    </body>
    <script>
        
        var selectedUsers = new Array();
        
        var accountableUser = {!myRole.Accountable__c};
        var responsibleUser = {!myRole.Responsible__c};
        var backupUser = {!myRole.Backup_for_Accountable__c};
        var SAUser = {!myRole.Accountable__c};
        var currentPhase = document.getElementById('chkStatus').innerHTML;
        var currentUserId = $('#currentUserId').html();
        
        $('#searchText').keypress(function(e){
            if (e.keyCode == '13'){
              //alert(this.value);
              searchUsers();
              return false;
            }
        });
        
        function deleteUserFromEditTable(title,socialInputIdToBeDeleted){
            if(title == '' || title == null)
                return false;
            setDimension();
            $('.tbl-disable').css('display','block');
            deleteThisUser(socialInputIdToBeDeleted);
            //alert(socialInputIdToBeDeleted);  
        }
        
        
        
        function singleAccounatble(checkBox,disabledUrl,enabledUrl) {
            document.getElementById('deletingIcon'+checkBox).src = disabledUrl; // title="Image title";
            document.getElementById('deletingIcon'+checkBox).style.cursor="default";
            document.getElementById('deletingIcon'+checkBox).title="";
            document.getElementById('mainPage:existingUserForm:peopleRepeat:'+checkBox+':accountableRole').checked = true;
            for(i=0;i<existingFormSize;i++){
                if(i != checkBox){
                    if(document.getElementById('mainPage:existingUserForm:peopleRepeat:'+i+':accountableRole').disabled == false){
                        if((document.getElementById('userAccountablity'+i).innerHTML == 'NOTACCOUNTABLE') && (document.getElementById('userID'+i).innerHTML != currentUserId)){         
                            document.getElementById('deletingIcon'+i).src = enabledUrl;
                            document.getElementById('deletingIcon'+i).style.cursor="pointer";
                            document.getElementById('deletingIcon'+i).title="Delete";
                        }
                        document.getElementById('mainPage:existingUserForm:peopleRepeat:'+i+':accountableRole').checked = false;    
                    }
                }
            }
        }
        
        // remove quate from json string 
        function removeQuotes(mystring) {
                
            newString = mystring.replace(/&(lt|gt|quot);/g, function (m, p) { 
                return (p == "lt") ? "<" : ((p == "gt") ? ">" : "\"");
            });
            
            var newJ= $.parseJSON(newString);
            return newJ;
        }
     </script>
   
  
     
    <script>
        // **************** Kendo table Java script  ********************//
        
        function kendoGroupMember(gridData) {
            //alert(gridData);
            var data1 = gridData;
            $.ajaxSetup({ cache: true }); 
            $(".k-grid-header .k-header").off("click.kendoSortable").on("click", false);
            // new way or style
            var dataSource = new kendo.data.DataSource({
                
                transport: {
                    read: function(e) {  
                        dataSource.sync();
                        e.success(data1);
                    }
                 },
                 schema: {
                       model: {
                          name: "name",
                          fields: {
                              name: { type: "string" },
                              userImage: { type: "string" },
                              department: { type: "string" }
                          }
                      }
                   },
                   pageSize :10
            });
            
            var grid = $("#gridGroupMember").kendoGrid({
                
                dataSource: dataSource,  
                scrollable: false,
                sortable: true,
                pageable: true,                            
                columns: [
                       {
                           field: "name",
                           title: "Name",
                           template: '<div class="grid-user-img"><img src=#:userImage# title= "#:name#" height="24px" width="24px"  /></div><div class="grid-user-img group-link">#:name#</div>'
                          
                       },
                       {
                           field: "department",
                           title: "Department",   
                           template: "#:department#",                    
                           width: 180
                       }
                  ]
            }).data("kendoGrid");
            
           
        }
        
        function kendoSearchTable(gridData) {
            $("#gridSearchUsers").kendoGrid({
               dataSource:{
                   data:gridData ,
                   schema: {
                       model: {
                          id: "id",
                          fields: {
                              id: { type: "string" },
                              selectUser:{type: "boolean" },
                              userName:{type: "string" },
                              dept:{type: "string" }
                          }
                      }
                   },
                   pageSize: 7
               },
               columns: [ 
                    {
                       field: "selectUser",
                       title: "Select",
                       sortable: false,
                       template: kendo.template($("#checkbox-template").html()),
                       width: 55
                   },
                   {
                       field: "userName",
                       title: "Name",
                       template: "<div class='grid-user-img'><img src=#:userImage# height='24px' width='24px' title='#:userName#'></div><div class='grid-user-img group-link'><a class='group-link' href='javascript:void(0);' onclick=\"redirectUserTo('#:userId#','#:redirectUrl#','#:userName#')\"; >#:userName#</a><div id = 'decHidden'>#:userNameList#</div></div>"
                   },
                   {
                       field: "dept",
                       title: "Department",
                       template: "#:dept#",
                       width: 180
                   },
              ],
              scrollable: false,
              sortable: true,
              pageable: true
           });
            
            var grid = $("#gridSearchUsers").data("kendoGrid");
            grid.tbody.on("change", ".done", function (e) { 
                var row = $(e.target).closest("tr");
                var item = grid.dataItem(row);
                var $target = $(e.currentTarget);
                item.set("selectUser", $(e.target).is(":checked") ? 'true' : 'false');
             });
           
           $('.group-link').hover(function(e) {                                   
              var content = $(this).next().html();
              if(content != '' && content != undefined ){
                  content = content.replace(/,/g, '<br>');
                  $('.popover-social-content').html(content);                   
                  $('.popover-social').show()
                  .css('top', e.pageY - 25)
                  .css('left', e.pageX + 50)
                  .appendTo('body');
              }
           },function() {
           $('.popover-social').hide();
          });
        }
        
        function addAsUsersFromDecision(){
        
           
            var userType = 'User'
            var addingAsResponsible = $('#responsibleUser').is(':checked') ? 'responsibleReqd' : 'noResponsible';
            var addingAsConsulted = $('#consultedUser').is(':checked') ? 'consultedReqd' : 'noConsulted';
            var addingAsInformed = $('#informedUser').is(':checked') ? 'informedReqd' : 'noInformed'; 
            if(selectedUsers.length == 0){
                alert('Please select users');
                return false;
            }
            if(addingAsResponsible=='noResponsible' && addingAsConsulted=='noConsulted' && addingAsInformed=='noInformed'){
                alert('Please select the role for selected users');
                return false;
            }
            $('#addUserButton').addClass('btn-disabled');
            //$('#addUserButton1').css('display','block');
            $('#onluaddUserButtoninwrrap').addClass('btn-disabled');
            var selectedUserStr = selectedUsers.toString();
            //alert(selectedUserStr+','+userType+','+addingAsInformed+','+addingAsResponsible+','+addingAsConsulted);
            AddUsers(selectedUserStr,userType,addingAsInformed,addingAsResponsible,addingAsConsulted);
        }
        
        
        function addAsUsersFromDecisionWrapper(){
            var userType = 'User'
            var addingAsResponsible = $('#responsibleUser').is(':checked') ? 'responsibleReqd' : 'noResponsible';
            var addingAsConsulted = $('#consultedUser').is(':checked') ? 'consultedReqd' : 'noConsulted';
            var addingAsInformed = $('#informedUser').is(':checked') ? 'informedReqd' : 'noInformed'; 
            if(selectedUsers.length == 0){
                alert('Please select users');
                return false;
            }
            if(addingAsResponsible=='noResponsible' && addingAsConsulted=='noConsulted' && addingAsInformed=='noInformed'){
                alert('Please select the role for selected users');
                return false;
            }
            $('#addUserButton').addClass('btn-disabled');
            //$('#addUserButton1').css('display','block');
            $('#onluaddUserButtoninwrrap').addClass('btn-disabled');
            //$('#onluaddUserButtoninwrrap1').css('display','block');
            var selectedUserStr = selectedUsers.toString();
            //console.log(selectedUserStr);
            AddUserinwrapp(selectedUserStr,userType,addingAsInformed,addingAsResponsible,addingAsConsulted);
        }
       
        
    </script>
    <script id="checkbox-template" type="text/kendo-ui-template">
      <div align="center"> <input type="checkbox" class="done" onclick="selectUserFunc('#:userId#')"   #if(selectUser){# checked="checked" #}#></input></div>
    </script>
    <apex:includeScript value="{!URLFOR($Resource.JqueryUITabs, '/tabs/jqueryui-1.9.1.js')}"/> 
    <apex:includeScript value="{!URLFOR($Resource.KendoMetroNewLibrary, '/kendoMetroNewLibrary/kendo.all.min.js')}"/> 
    <apex:includeScript value="{!URLFOR($Resource.KendoMetro, '/kendoNew/js/console.js')}"/>
</html>               
</apex:page>